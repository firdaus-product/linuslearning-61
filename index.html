<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Operasi Darab (Pembelajaran)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 400px; }
    .number-card { transition: all .3s ease; cursor: pointer; }
    .number-card:hover { transform: scale(1.05); }
    .dragging { opacity: .5; transform: rotate(5deg); }

    /* Drop zone */
    .drop-zone {
      border: 2px dashed #cbd5e1;
      transition: all .3s ease;
      min-width: 60px;
      min-height: 60px;
      display: inline-block;
      vertical-align: middle;
    }
    .drop-zone.drag-over { border-color: #3b82f6; background-color: #eff6ff; }

    /* Salah */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }

    /* Zon sudah diisi */
    .drop-zone-filled {
      border-style: solid;
      border-color: #4ade80;
      background-color: #f0fdf4;
    }
    
    /* Guli (Aktiviti 2) */
    .guli-source {
      width: 50px; height: 50px;
      background-color: #0ea5e9; /* sky-500 */
      border: 3px solid #0284c7; /* sky-600 */
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: move;
    }
    .bekas-guli {
      width: 120px;
      height: 120px;
      padding: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-content: flex-start;
    }
    .bekas-guli .guli {
      width: 30px; height: 30px;
      background-color: #0ea5e9;
      border-radius: 50%;
    }

    /* Tatasusunan (Aktiviti 1) */
    .grid-cell {
      width: 40px; height: 40px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .grid-cell:hover { background-color: #e0e0e0; }
    .grid-cell.active { background-color: #60a5fa; border-color: #2563eb; }

  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üìö</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti untuk mula belajar darab!
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        üîä
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full">
        <div class="py-16">
          <div class="text-6xl mb-4">‚ùå</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Kemahiran Pemulihan: Operasi Darab
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Jom teroka pendaraban. Pilih aktiviti di bawah.
          </p>
          <div class="text-4xl">üëá</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          1. Bina Tatasusunan
        </button>
        <button onclick="loadActivity(2)"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          2. Bekas & Guli
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          3. Penjana Sifir
        </button>
        <button onclick="loadActivity(4)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          4. Tali Sifir
        </button>
        <button onclick="loadActivity(5)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          5. Padanan Visual
        </button>
      </div>

      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          üßπ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          ‚û°Ô∏è Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar darab!"; // Diubah suai
    let draggedElement = null;

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY';
        u.rate = 0.9; u.pitch = 1.05;
        const voices = window.speechSynthesis.getVoices();
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;
        window.speechSynthesis.speak(u);
      }, 100);
    }
    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300', 'hover:bg-green-400');
        btn.classList.remove('bg-yellow-300', 'hover:bg-yellow-400');
      }
      speak(currentInfo);
    }

    /* ====== DnD helpers ====== */
    function dragStart(e) { draggedElement = e.target; e.target.classList.add('dragging'); }
    function dragEnd(e) { if(draggedElement) draggedElement.classList.remove('dragging'); document.querySelectorAll('.drop-zone').forEach(z=>z.classList.remove('drag-over')); }
    function allowDrop(e) { e.preventDefault(); if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.add('drag-over'); }
    function dragLeave(e) { if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.remove('drag-over'); }

    /* ====== Router ====== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      if (n === 1) return loadArrayActivity(content);
      if (n === 2) return loadContainerActivity(content);
      if (n === 3) return loadGeneratorActivity(content);
      if (n === 4) return loadSifirBuilder(content);
      if (n === 5) return loadMatchingActivity(content);
    }

    /* ====== Aktiviti 1: Bina Tatasusunan ====== */
    function loadArrayActivity(content) {
      setInfo("Klik pada mana-mana petak untuk membina tatasusunan. Lihat bagaimana baris dan lajur dikira.");
      let rows = 6, cols = 8;
      let gridHtml = "";
      for (let r = 1; r <= rows; r++) {
        gridHtml += `<div class="flex justify-center">`;
        for (let c = 1; c <= cols; c++) {
          gridHtml += `<div class="grid-cell" data-row="${r}" data-col="${c}" onclick="buildArray(this, ${r}, ${c})"></div>`;
        }
        gridHtml += `</div>`;
      }

      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-600 mb-6">1. Bina Tatasusunan</h3>
        <div class="mb-4 text-center">
          <div id="array-grid" class="inline-block border border-gray-400">${gridHtml}</div>
        </div>
        <div id="array-result" class="mt-4 p-4 bg-blue-50 rounded-lg text-xl font-semibold text-blue-800 min-h-16">
          Klik petak untuk mula.
        </div>
        <button onclick="loadActivity(1)" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
          Set Semula
        </button>
      `;
    }
    function buildArray(cell, r, c) {
      const cells = document.querySelectorAll('#array-grid .grid-cell');
      cells.forEach(c => c.classList.remove('active'));
      for (let i = 1; i <= r; i++) {
        for (let j = 1; j <= c; j++) {
          document.querySelector(`.grid-cell[data-row="${i}"][data-col="${j}"]`).classList.add('active');
        }
      }
      const total = r * c;
      const msg = `${r} baris darab ${c} lajur sama dengan ${total}.`;
      document.getElementById('array-result').textContent = msg;
      setInfo(msg);
      speak(msg);
    }

    /* ====== Aktiviti 2: Bekas & Guli ====== */
    function loadContainerActivity(content) {
      setInfo("Jom buat 3 kumpulan 4. Seret guli ke dalam setiap bekas sehingga penuh (4 biji).");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-green-600 mb-6">2. Bekas & Guli</h3>
        <div class="flex flex-col md:flex-row items-center justify-around gap-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold mb-3">Ambil Guli:</h4>
            <div class="guli-source" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)">ü•é</div>
          </div>
          <div class="text-center">
            <h4 class="text-lg font-semibold mb-3">Letak Dalam Bekas:</h4>
            <div class="flex flex-wrap justify-center gap-4">
              <div class="bekas-guli drop-zone rounded-lg" ondrop="dropOnBekas(event, 3, 4)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-count="0" data-target="4"></div>
              <div class="bekas-guli drop-zone rounded-lg" ondrop="dropOnBekas(event, 3, 4)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-count="0" data-target="4"></div>
              <div class="bekas-guli drop-zone rounded-lg" ondrop="dropOnBekas(event, 3, 4)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-count="0" data-target="4"></div>
            </div>
          </div>
        </div>
        <div id="bekas-result" class="mt-6 p-4 bg-green-50 rounded-lg text-xl font-semibold text-green-800 min-h-16">
          3 bekas disediakan. Setiap satu perlukan 4 guli.
        </div>
      `;
    }
    function dropOnBekas(e, totalBekas, targetPerBekas) {
      e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
      let count = parseInt(e.currentTarget.dataset.count);
      const target = parseInt(e.currentTarget.dataset.target);
      if (count < target) {
        count++;
        e.currentTarget.dataset.count = count;
        e.currentTarget.innerHTML += '<div class="guli"></div>';
        const msg = `Satu guli ditambah. Bekas ini ada ${count} guli.`;
        setInfo(msg); speak(msg);
        if (count === target) {
          e.currentTarget.classList.add('drop-zone-filled');
          e.currentTarget.classList.remove('drop-zone');
          const msgPenuh = `Bagus! Bekas ini penuh dengan ${target} guli.`;
          setInfo(msgPenuh); speak(msgPenuh);
        }
        // Semak jika semua dah penuh
        const allBekas = document.querySelectorAll('.bekas-guli');
        let filledBekas = 0;
        allBekas.forEach(b => {
          if (parseInt(b.dataset.count) === target) filledBekas++;
        });
        if (filledBekas === totalBekas) {
          const totalGuli = totalBekas * targetPerBekas;
          const msgSiap = `Syabas! ${totalBekas} bekas dengan ${targetPerBekas} guli setiap satu. Semuanya ${totalGuli} guli!`;
          document.getElementById('bekas-result').textContent = msgSiap;
          setInfo(msgSiap); speak(msgSiap);
        }
      } else {
        const msg = "Bekas ini sudah penuh.";
        setInfo(msg); speak(msg);
        e.currentTarget.classList.add('shake');
        setTimeout(()=>e.currentTarget.classList.remove('shake'), 500);
      }
    }

    /* ====== Aktiviti 3: Penjana Sifir ====== */
    function loadGeneratorActivity(content) {
      setInfo("Pilih bilangan kumpulan dan bilangan ahli. Tekan 'Jana Visual' untuk lihat hasilnya.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-600 mb-6">3. Penjana Sifir</h3>
        <div class="flex flex-wrap justify-center items-center gap-4 mb-6">
          <label class="font-semibold">Bilangan Kumpulan:</label>
          <select id="select-kumpulan" class="p-2 border rounded-lg">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <label class="font-semibold">Bilangan Ahli (setiap kumpulan):</label>
          <select id="select-ahli" class="p-2 border rounded-lg">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <button onclick="janaSifir()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg">
            Jana Visual
          </button>
        </div>
        <div id="visual-result" class="mt-4 p-4 bg-purple-50 rounded-lg min-h-32 text-center">
          <p class="text-gray-500">Visual akan muncul di sini.</p>
        </div>
      `;
    }
    function janaSifir() {
      const k = parseInt(document.getElementById('select-kumpulan').value);
      const a = parseInt(document.getElementById('select-ahli').value);
      const resultEl = document.getElementById('visual-result');
      resultEl.innerHTML = ''; // Kosongkan
      
      let visualHtml = `<div class="flex flex-wrap justify-center gap-3">`;
      for (let i = 0; i < k; i++) {
        visualHtml += `<div class="border-2 border-purple-300 bg-white rounded-lg p-2 min-w-16">`;
        for (let j = 0; j < a; j++) {
          visualHtml += `<span class="text-2xl">‚≠ê</span>`;
        }
        visualHtml += `</div>`;
      }
      visualHtml += `</div>`;
      
      const total = k * a;
      const msg = `${k} kumpulan darab ${a} ahli sama dengan ${total}.`;
      resultEl.innerHTML = `
        <h4 class="text-xl font-bold text-purple-800 mb-4">${msg}</h4>
        ${visualHtml}
      `;
      setInfo(msg); speak(msg);
    }

    /* ====== Aktiviti 4: Tali Sifir (Penambahan Berulang) ====== */
    function loadSifirBuilder(content) {
      setInfo("Jom bina sifir 3. Tekan butang '+ Tambah 3 lagi' untuk lihat penambahan berulang.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-6">4. Tali Sifir (Sifir 3)</h3>
        <div class="text-center mb-6">
          <button onclick="addSifir(3)" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg text-xl">
            + Tambah 3 lagi üëö
          </button>
        </div>
        <div id="tali-sifir-line" class="flex flex-wrap justify-center gap-1 p-4 bg-orange-50 rounded-lg min-h-24 border-2 border-orange-200">
          </div>
        <h4 class="text-center text-3xl font-bold text-orange-800 mt-4">
          Jumlah: <span id="sifir-total">0</span>
        </h4>
      `;
    }
    function addSifir(num) {
      const tali = document.getElementById('tali-sifir-line');
      const totalEl = document.getElementById('sifir-total');
      const currentTotal = parseInt(totalEl.textContent);
      
      if (currentTotal >= 30) { // Had
        const msg = "Hebat! Anda sudah sampai 30. Tekan 'Set Semula' untuk mula balik.";
        setInfo(msg); speak(msg);
        loadSifirBuilder(document.getElementById('activity-content')); // Reset
        return;
      }
      
      for (let i = 0; i < num; i++) {
        tali.innerHTML += `<span class="text-3xl">üëö</span>`;
      }
      const newTotal = currentTotal + num;
      totalEl.textContent = newTotal;
      const msg = `Bagus! ${currentTotal} tambah ${num} jadi ${newTotal}.`;
      setInfo(msg); speak(msg);
    }

    /* ====== Aktiviti 5: Padanan Visual ====== */
    function loadMatchingActivity(content) {
      setInfo("Seret ayat matematik di sebelah kiri ke gambar yang betul di sebelah kanan.");
      const items = [
        { eq: "2 x 4", visual: "‚öΩ‚öΩ‚öΩ‚öΩ<br>‚öΩ‚öΩ‚öΩ‚öΩ", count: 8 },
        { eq: "3 x 2", visual: "‚≠ê<br>‚≠ê<br>‚≠ê", count: 6 }, // Visual salah, betulkan
        { eq: "4 x 1", visual: "üöÄ<br>üöÄ<br>üöÄ<br>üöÄ", count: 4 }
      ];
      // Betulkan visual
      items[1].visual = "‚≠ê‚≠ê<br>‚≠ê‚≠ê<br>‚≠ê‚≠ê";
      
      const shuffledItems = [...items].sort(() => Math.random() - 0.5);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-red-600 mb-6">5. Padanan Visual</h3>
        <div class="flex flex-col md:flex-row justify-around gap-6">
          <div class="w-full md:w-1/3">
            <h4 class="text-lg font-semibold mb-3 text-center">Ayat Matematik (Seret):</h4>
            <div id="match-source" class="flex flex-col gap-4">
              ${items.sort(()=>Math.random()-0.5).map(item => `
                <div class="number-card bg-red-100 border-2 border-red-300 rounded-lg p-4 text-2xl font-bold text-red-800 text-center cursor-move"
                     draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-answer="${item.eq}">
                  ${item.eq}
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="w-full md:w-2/3">
            <h4 class="text-lg font-semibold mb-3 text-center">Gambar (Letak di sini):</h4>
            <div id="match-target" class="flex flex-col gap-4">
              ${shuffledItems.map(item => `
                <div class="drop-zone rounded-lg p-4 text-2xl font-bold text-center flex items-center gap-4 bg-gray-50"
                     ondrop="dropOnMatch(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-correct="${item.eq}">
                  <div class="w-1/2 text-center text-3xl leading-tight">${item.visual}</div>
                  <div class="w-1/2 text-gray-400">__ = ${item.count}</div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    function dropOnMatch(e) {
      e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
      
      const draggedAnswer = draggedElement.dataset.answer;
      const correctNumber = e.currentTarget.dataset.correct;
      
      if (draggedAnswer === correctNumber) {
        e.currentTarget.innerHTML = `<h3 class="text-green-600">${draggedAnswer} = ${draggedAnswer.split('x').reduce((a,b) => a*b)}</h3>`;
        e.currentTarget.classList.add('drop-zone-filled');
        e.currentTarget.classList.remove('drop-zone');
        e.currentTarget.removeAttribute('ondrop');
        draggedElement.remove(); draggedElement = null;
        
        const msg = `Betul! ${draggedAnswer} padan dengan gambar itu.`;
        setInfo(msg); speak(msg);
        
        if (document.querySelectorAll('#match-source .number-card').length === 0) {
          setInfo("Syabas! Semua berjaya dipadankan!"); speak("Syabas! Semua berjaya dipadankan!");
        }
      } else {
        const msg = `Bukan yang itu. Cuba padanan lain.`;
        setInfo(msg); speak(msg);
        e.currentTarget.classList.add('shake');
        setTimeout(()=>e.currentTarget.classList.remove('shake'), 500);
      }
    }


    /* ====== Kawalan Umum ====== */
    function clearActivity() {
      currentActivity = 0;
      // KANDUNGAN DEFAULT DIUBAH SUAI
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">‚ùå</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Kemahiran Pemulihan: Operasi Darab</h2>
          <p class="text-xl text-gray-600 mb-8">Jom teroka pendaraban. Pilih aktiviti di bawah.</p>
          <div class="text-4xl">üëá</div>
        </div>
      `;
      setInfo("Pilih aktiviti untuk mula belajar darab!");
    }
    
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      // Logik 5 aktiviti dikekalkan
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }

    // Kekalkan TTS resume pada sesetengah pelayar
    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
